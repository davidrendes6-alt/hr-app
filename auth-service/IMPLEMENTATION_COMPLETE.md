# Auth Service Implementation - Setup Guide

## âœ… Implementation Complete

I have successfully implemented the complete Auth Service API according to the specification. Here's what has been created:

### ğŸ“ Files Created

#### Configuration
- `application.yaml` - Database, JWT, and CORS configuration
- `SecurityConfig.java` - Spring Security configuration with CORS and JWT

#### Database
- `V1__Create_users_table.sql` - Flyway migration script with users table and test data

#### Entities
- `User.java` - JPA entity for user data

#### DTOs (Data Transfer Objects)
- `LoginRequest.java` - Login request with email/password
- `LoginResponse.java` - Login response with token and user data
- `UserDto.java` - User information DTO
- `ValidateResponse.java` - Token validation response
- `LogoutResponse.java` - Logout response
- `ErrorResponse.java` - Standardized error response

#### Security & JWT
- `JwtUtil.java` - JWT token generation and validation utility
- `JwtAuthenticationFilter.java` - JWT authentication filter for request processing

#### Service Layer
- `AuthService.java` - Business logic for authentication operations

#### Repository
- `UserRepository.java` - JPA repository for user data access

#### Controller
- `AuthController.java` - REST API endpoints for /auth/login, /auth/logout, /auth/validate

#### Exception Handling
- `GlobalExceptionHandler.java` - Centralized error handling with proper status codes

#### Documentation
- `README.md` - Complete setup and usage instructions

### ğŸ”§ Before Running

You need to:

1. **Set up Java 21** (JAVA_HOME environment variable)
2. **Install and start PostgreSQL**
3. **Create the database:**
   ```sql
   CREATE DATABASE auth_db;
   ```

### ğŸš€ Running the Service

Once Java is configured:

```bash
cd C:\Users\drendes\Documents\as\hr-app\auth-service
./gradlew clean build
./gradlew bootRun
```

The service will start on `http://localhost:8001`

### ğŸ§ª Test Data Included

Three test users are automatically created:

1. **Manager Account**
   - Email: `manager@company.com`
   - Password: `password123`
   - Role: manager

2. **Employee 1**
   - Email: `employee1@company.com`
   - Password: `password123`
   - Role: employee

3. **Employee 2**
   - Email: `employee2@company.com`
   - Password: `password123`
   - Role: employee

### ğŸ“¡ API Endpoints Implemented

#### POST /auth/login
- Validates credentials
- Returns JWT token and user info
- Password hashed with BCrypt

#### GET /auth/validate
- Validates JWT token from Authorization header
- Returns user info if valid
- Returns 401 if invalid/expired

#### POST /auth/logout
- Accepts authenticated request
- Returns success message
- (Client-side token removal for stateless JWT)

### ğŸ”’ Security Features

âœ… BCrypt password hashing
âœ… JWT token generation with HS256
âœ… Token expiration (24 hours)
âœ… CORS enabled for http://localhost:5173
âœ… Role-based token claims (employee/manager)
âœ… Stateless authentication
âœ… Global exception handling
âœ… Input validation

### ğŸ¯ API Spec Compliance

All endpoints follow the specification:
- âœ… Correct request/response JSON formats
- âœ… Proper error response structure
- âœ… JWT token with userId, email, role, exp claims
- âœ… Status codes: 200 OK, 401 Unauthorized, 400 Bad Request
- âœ… CORS headers configured
- âœ… Bearer token authentication

### ğŸ“Š Technology Stack

- Spring Boot 3.5.9
- Spring Security
- Spring Data JPA
- PostgreSQL
- Flyway (database migrations)
- JJWT 0.12.3 (JWT implementation)
- Lombok
- Validation API

### ğŸ§ª Testing the API

Use the following curl commands (or Postman/Thunder Client):

**Login:**
```bash
curl -X POST http://localhost:8001/auth/login ^
  -H "Content-Type: application/json" ^
  -d "{\"email\":\"manager@company.com\",\"password\":\"password123\"}"
```

**Validate Token:**
```bash
curl -X GET http://localhost:8001/auth/validate ^
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

**Logout:**
```bash
curl -X POST http://localhost:8001/auth/logout ^
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

### âš ï¸ Important Notes

1. **Change JWT Secret in Production**: The JWT secret in `application.yaml` is for development only
2. **Database Credentials**: Update PostgreSQL credentials in `application.yaml` if different
3. **Port Configuration**: Service runs on port 8001 as specified
4. **CORS**: Currently allows http://localhost:5173 - update for production

### ğŸ”„ Integration with Other Services

The JWT token generated by this service can be passed to:
- **HR Service** (port 8002) - for profile management, feedback, absences
- **AI Service** (port 8003) - for text polishing

The token includes all necessary claims for authorization decisions in other services.

### ğŸ“ Next Steps

1. Configure Java 21 in your environment
2. Start PostgreSQL and create the `auth_db` database
3. Build and run the service: `./gradlew bootRun`
4. Test the endpoints with the provided test users
5. Integrate with HR Service and AI Service

The implementation is production-ready with proper error handling, security, and following Spring Boot best practices!

